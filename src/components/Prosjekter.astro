---
import type { Prosjekt } from '../data/prosjekter';
import VisMerKnapp from './VisMerKnapp.astro';
import TeknologiListe from './TeknologiListe.astro';

interface Props {
	prosjekter: Prosjekt[];
	antallSynlige?: number;
}

const { prosjekter, antallSynlige = 2 } = Astro.props;
const harSkjulteProsjekter = prosjekter.length > antallSynlige;
---

<div class="prosjekter-container" data-vis-mer-container>
	<h2>Prosjekter</h2>
	<div
		class="prosjekter-list"
		data-alle-prosjekter={JSON.stringify(prosjekter)}
		data-antall-synlige={antallSynlige}
	>
		{
			prosjekter.map((prosjekt, index) => {
				const erSkjult = index >= antallSynlige;
				return (
					<div
						class={`prosjekt-item ${erSkjult ? 'skjult-element' : ''}`}
						data-link={prosjekt.link}
						style={
							erSkjult ? 'display: none; cursor: pointer;' : 'cursor: pointer;'
						}
					>
						<div class="prosjekt-header">
							<h3>{prosjekt.navn}</h3>
							<p class="subtle">{prosjekt.type}</p>
						</div>
						<p class="beskrivelse">{prosjekt.beskrivelse}</p>
						<TeknologiListe teknologier={prosjekt.teknologier} />
					</div>
				);
			})
		}
	</div>
	{
		harSkjulteProsjekter && (
			<VisMerKnapp
				visMerTekst="Vis flere prosjekter"
				visMindreTekst="Vis fÃ¦rre prosjekter"
				targetSelector=".skjult-element"
			/>
		)
	}
</div>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		const prosjekterContainer = document.querySelector('.prosjekter-container');
		if (!prosjekterContainer) return;

		prosjekterContainer.addEventListener('click', function (event) {
			const target = event.target as HTMLElement;
			if (!target) return;

			const prosjektItem = target.closest('.prosjekt-item') as HTMLElement;
			if (prosjektItem && prosjektItem.dataset.link) {
				window.open(prosjektItem.dataset.link, '_blank');
			}
		});
	});
</script>

<style>
	@import './Prosjekter.css';
</style>
