---
import type { Prosjekt } from '../data/prosjekter';
import VisMerKnapp from './VisMerKnapp.astro';
import TeknologiListe from './TeknologiListe.astro';

interface Props {
	prosjekter: Prosjekt[];
	antallSynlige?: number;
}

const { prosjekter, antallSynlige = 2 } = Astro.props;
const synligeProsjekter = prosjekter.slice(0, antallSynlige);
const harSkjulteProsjekter = prosjekter.length > antallSynlige;
---

<div class="prosjekter-container">
	<h2>Prosjekter</h2>
	<div
		class="prosjekter-list"
		data-alle-prosjekter={JSON.stringify(prosjekter)}
		data-antall-synlige={antallSynlige}
	>
		{
			synligeProsjekter.map((prosjekt, index) => (
				<div
					class="prosjekt-item"
					data-link={prosjekt.link}
					style="cursor: pointer;"
				>
					<h3>{prosjekt.navn}</h3>
					<p class="beskrivelse">{prosjekt.beskrivelse}</p>
					<TeknologiListe teknologier={prosjekt.teknologier} />
				</div>
			))
		}
		{
			prosjekter.slice(antallSynlige).map((prosjekt, index) => (
				<div
					class="prosjekt-item skjult-prosjekt"
					data-link={prosjekt.link}
					style="display: none; cursor: pointer;"
				>
					<h3>{prosjekt.navn}</h3>
					<p class="beskrivelse">{prosjekt.beskrivelse}</p>
					<TeknologiListe teknologier={prosjekt.teknologier} />
				</div>
			))
		}
	</div>
	{
		harSkjulteProsjekter && (
			<VisMerKnapp
				visMerTekst="Vis flere prosjekter"
				visMindreTekst="Vis færre prosjekter"
			/>
		)
	}
</div>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		const prosjekterContainer = document.querySelector('.prosjekter-container');
		if (!prosjekterContainer) return;

		// Håndter klikk på prosjekter
		prosjekterContainer.addEventListener('click', function (event) {
			const target = event.target as HTMLElement;
			if (!target) return;

			const prosjektItem = target.closest('.prosjekt-item') as HTMLElement;
			if (prosjektItem && prosjektItem.dataset.link) {
				window.open(prosjektItem.dataset.link, '_blank');
			}
		});

		const button = prosjekterContainer.querySelector('.vis-mer-knapp');
		if (!button) return;

		button.addEventListener('click', function () {
			const skjulteProsjekter = prosjekterContainer.querySelectorAll(
				'.skjult-prosjekt'
			) as NodeListOf<HTMLElement>;

			skjulteProsjekter.forEach((prosjekt) => {
				if (prosjekt.style.display === 'none') {
					prosjekt.style.display = '';
				} else {
					prosjekt.style.display = 'none';
				}
			});
		});
	});
</script>

<style>
	@import './Prosjekter.css';
</style>
