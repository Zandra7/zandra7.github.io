---
import type { Prosjekt } from '../data/prosjekter';
import VisMerKnapp from './VisMerKnapp.astro';
import TeknologiListe from './TeknologiListe.astro';

interface Props {
	prosjekter: Prosjekt[];
	antallSynlige?: number;
}

const { prosjekter, antallSynlige = 2 } = Astro.props;
const harSkjulteProsjekter = prosjekter.length > antallSynlige;
---

<section
	class="prosjekter-container"
	data-vis-mer-container
	aria-labelledby="prosjekter-heading"
>
	<h2 id="prosjekter-heading">Prosjekter</h2>
	<ul
		class="prosjekter-list"
		data-alle-prosjekter={JSON.stringify(prosjekter)}
		data-antall-synlige={antallSynlige}
		role="list"
	>
		{
			prosjekter.map((prosjekt, index) => {
				const erSkjult = index >= antallSynlige;
				return (
					<li
						class={erSkjult ? 'skjult-element' : ''}
						style={erSkjult ? 'display: none;' : ''}
					>
						<article>
							<a
								class={`prosjekt-item`}
								href={prosjekt.link}
								style={erSkjult ? 'cursor: pointer;' : 'cursor: pointer;'}
							>
								<div class="prosjekt-header">
									<h3>{prosjekt.navn}</h3>
									<p class="subtle">{prosjekt.type}</p>
								</div>
								<p class="beskrivelse">{prosjekt.beskrivelse}</p>
								<TeknologiListe teknologier={prosjekt.teknologier} />
							</a>
						</article>
					</li>
				);
			})
		}
	</ul>
	{
		harSkjulteProsjekter && (
			<VisMerKnapp
				visMerTekst="Vis flere prosjekter"
				visMindreTekst="Vis fÃ¦rre prosjekter"
				targetSelector=".skjult-element"
			/>
		)
	}
</section>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		const prosjekterContainer = document.querySelector('.prosjekter-container');
		if (!prosjekterContainer) return;

		prosjekterContainer.addEventListener('click', function (event) {
			const target = event.target as HTMLElement;
			if (!target) return;

			const prosjektItem = target.closest('.prosjekt-item') as HTMLElement;
			if (prosjektItem && prosjektItem.dataset.link) {
				window.open(prosjektItem.dataset.link, '_blank');
			}
		});
	});
</script>

<style>
	@import './Prosjekter.css';
</style>
